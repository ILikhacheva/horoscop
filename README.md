# Приложение Гороскопов

## Описание
Web-приложение для создания персонализированных гороскопов с использованием OpenAI API и PostgreSQL.

## Установка и настройка

### 1. Установка зависимостей
```bash
npm install
```

### 2. Настройка базы данных PostgreSQL

1. Установите PostgreSQL на вашем компьютере
2. Создайте базу данных:
```sql
CREATE DATABASE horoscope_db;
```

3. Выполните SQL-скрипт для создания таблиц:
```bash
psql -U your_username -d horoscope -f init_database.sql
```

### 3. Настройка переменных окружения

1. Скопируйте файл `.env.example` в `.env`:
```bash
cp .env.example .env
```

2. Заполните необходимые данные в `.env`:
- `DB_HOST`, `DB_PORT`, `DB_NAME`, `DB_USER`, `DB_PASSWORD` - данные вашей PostgreSQL базы
- `OPENAI_API_KEY` - ваш ключ OpenAI API

### 4. Запуск приложения

```bash
npm start
```

Приложение будет доступно по адресу: http://localhost:3000

## Структура проекта

- `index.js` - основной файл сервера
- `database.js` - модуль для работы с базой данных
- `utils.js` - утилиты и валидация
- `init_database.sql` - SQL-скрипт для создания структуры БД
- `public/` - статические файлы (HTML, CSS, JS клиентской части)

## API Endpoints

### Регистрация
- **POST** `/api/register`
- Параметры: `email`, `name`, `birthday`, `zodiac`, `password`

### Авторизация
- **POST** `/api/login`
- Параметры: `email`, `password`

### Получение гороскопа
- **POST** `/api/horoscope`
- Параметры: `name`, `zodiac`, `date`, `birthday`, `isLoggedIn`

### Тестовые endpoints
- **GET** `/api/test` - проверка API
- **GET** `/api/test-db` - проверка подключения к БД
- **GET** `/api/users` - список пользователей

## Исправленные проблемы

1. ✅ Убраны дублирующиеся функции и инициализация
2. ✅ Исправлена ошибка в поле пароля при авторизации
3. ✅ Добавлена правильная валидация данных
4. ✅ Исправлены названия таблиц и полей в запросах
5. ✅ Добавлено правильное управление соединениями с БД
6. ✅ Улучшено логирование и обработка ошибок
7. ✅ Создана структура утилит для переиспользования кода

## Требования

- Node.js 14+
- PostgreSQL 12+
- OpenAI API Key
